# 新功能测试执行指南

## 测试概述

本指南提供了对智链OS新功能进行全面测试的步骤和方法。

## 测试环境准备

### 1. 启动服务

```bash
# 启动数据库（如果使用Docker）
docker-compose up -d postgres redis

# 启动后端API服务
cd apps/api-gateway
python -m uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

# 启动前端开发服务器
cd apps/web
npm run dev
```

### 2. 初始化测试数据

```bash
# 运行种子数据脚本
cd apps/api-gateway
python seed_database.py
```

### 3. 获取测试账号

使用以下测试账号登录：

- **管理员账号**
  - 用户名: `admin`
  - 密码: `admin123`

- **经理账号**
  - 用户名: `manager`
  - 密码: `manager123`

- **员工账号**
  - 用户名: `staff`
  - 密码: `staff123`

---

## 测试执行步骤

### 第一阶段：后端服务测试

#### 1. 运行集成测试

```bash
cd apps/api-gateway
python test_new_features.py
```

**预期结果：**
- 所有导入测试通过
- 所有服务功能测试通过
- 成功率 100%

**如果测试失败：**
1. 检查数据库连接
2. 确认种子数据已加载
3. 查看错误日志

#### 2. 运行API端点测试

```bash
cd apps/api-gateway
python test_api_endpoints.py
```

**预期结果：**
- 大部分API端点返回200状态码
- 需要认证的端点可能返回401（正常）
- 生成测试报告 `api_test_report.json`

**如果测试失败：**
1. 确认API服务器正在运行
2. 检查端口是否为8000
3. 查看API日志

---

### 第二阶段：前端页面测试

#### 1. 访问前端应用

打开浏览器访问: `http://localhost:5173`（或Vite配置的端口）

#### 2. 登录系统

使用管理员账号登录以访问所有功能。

#### 3. 按照测试清单逐一测试

参考 `FRONTEND_TEST_CHECKLIST.md` 文件，逐一测试每个页面和功能。

**测试顺序建议：**

1. **导航菜单测试** - 确保所有菜单项可访问
2. **多门店管理** - 测试门店对比和统计
3. **供应链管理** - 测试供应商和采购订单
4. **财务管理** - 测试财务报表和预算
5. **数据备份** - 测试备份创建和恢复
6. **数据可视化** - 测试图表显示
7. **移动端** - 测试移动端适配

---

### 第三阶段：集成测试

#### 1. 端到端流程测试

**场景1：采购到库存流程**
1. 在供应链管理中创建采购订单
2. 审批并标记为已送达
3. 在库存管理中查看库存变化

**场景2：销售到财务流程**
1. 在订单管理中创建订单
2. 完成订单
3. 在财务管理中查看收入记录
4. 在损益表中查看营收变化

**场景3：备份恢复流程**
1. 创建手动备份
2. 修改一些数据
3. 恢复备份
4. 验证数据已恢复

#### 2. 跨模块数据一致性测试

**测试点：**
- 门店统计数据与财务数据是否一致
- 采购订单金额与财务支出是否一致
- 库存补货建议与采购订单是否关联

---

### 第四阶段：性能测试

#### 1. 页面加载性能

使用浏览器开发者工具测试：
- 首次加载时间 < 3秒
- 页面切换时间 < 1秒
- API响应时间 < 500ms

#### 2. 大数据量测试

- 测试1000+条交易记录的加载
- 测试100+个备份文件的列表
- 测试复杂图表的渲染

---

### 第五阶段：安全测试

#### 1. 权限测试

- 使用普通用户账号尝试访问管理员页面
- 验证是否被正确拒绝
- 检查错误提示是否友好

#### 2. 输入验证测试

- 尝试提交空表单
- 尝试提交无效数据（负数、超长字符串等）
- 验证表单验证是否正常工作

#### 3. XSS测试

- 在文本输入框中输入 `<script>alert('XSS')</script>`
- 验证是否被正确转义

---

## 测试报告

### 测试结果记录

创建测试报告文件 `TEST_REPORT.md`，记录：

1. **测试环境**
   - 操作系统
   - 浏览器版本
   - 数据库版本
   - Python版本

2. **测试结果统计**
   - 总测试项数
   - 通过数
   - 失败数
   - 成功率

3. **发现的问题**
   - 问题描述
   - 严重程度（高/中/低）
   - 复现步骤
   - 截图（如有）

4. **性能数据**
   - 页面加载时间
   - API响应时间
   - 内存使用情况

5. **建议**
   - 需要修复的问题
   - 优化建议
   - 功能改进建议

---

## 常见问题排查

### 问题1：API测试失败（连接错误）

**原因：** API服务器未启动或端口不正确

**解决：**
```bash
# 检查API服务器是否运行
curl http://localhost:8000/api/v1/health

# 如果没有响应，启动API服务器
cd apps/api-gateway
python -m uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

### 问题2：数据库连接失败

**原因：** PostgreSQL未启动或连接配置错误

**解决：**
```bash
# 检查PostgreSQL是否运行
docker ps | grep postgres

# 如果没有运行，启动PostgreSQL
docker-compose up -d postgres

# 检查连接配置
cat apps/api-gateway/.env
```

### 问题3：前端页面空白

**原因：** 前端服务器未启动或构建失败

**解决：**
```bash
# 重新安装依赖
cd apps/web
npm install

# 启动开发服务器
npm run dev
```

### 问题4：权限错误（401/403）

**原因：** 未登录或权限不足

**解决：**
1. 确保已登录
2. 使用管理员账号测试管理员功能
3. 检查token是否有效

### 问题5：备份创建失败

**原因：** pg_dump未安装或权限不足

**解决：**
```bash
# 检查pg_dump是否安装
which pg_dump

# 如果未安装，安装PostgreSQL客户端工具
# macOS
brew install postgresql

# Ubuntu
sudo apt-get install postgresql-client

# 检查备份目录权限
ls -la ./backups
```

---

## 测试完成标准

测试被认为完成当：

1. ✅ 所有后端集成测试通过
2. ✅ 至少80%的API端点测试通过
3. ✅ 所有前端页面可以正常访问
4. ✅ 核心功能流程测试通过
5. ✅ 没有严重级别的bug
6. ✅ 性能指标达标
7. ✅ 安全测试通过

---

## 下一步

测试完成后：

1. 整理测试报告
2. 创建问题清单（如有）
3. 修复发现的问题
4. 重新测试修复的功能
5. 更新文档
6. 准备发布

---

**测试负责人：** ___________
**测试日期：** ___________
**测试版本：** ___________
